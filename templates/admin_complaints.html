<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Complaints</title>
    <link rel="stylesheet" href="../static/admin_home.css" />
    <link rel="stylesheet" href="../static/admin_complaints.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>
  <style>
  
  </style>
  <body>
    <div id="resolvePopup" class="notification-popup">
      <i class="fas fa-check-circle"></i>
      <span>Complaint resolved successfully!</span>
    </div>

    <div id="rejectPopup" class="notification-popup">
      <i class="fas fa-times-circle"></i>
      <span>Complaint rejected successfully!</span>
    </div>
    <div class="image">
      <h1 id="mobile">
        Welcome Back , <br />
        Admin {{username}}
      </h1>
      <h1 id="dekstop">Welcome Back , Admin {{username}}</h1>
      <div class="burger-icon open" id="burgerIcon">&#9776;</div>
      <div class="burger-icon close" id="burgerIconClose">&#10006;</div>
      <a href="/logout" class="logout-btn">Logout</a>
    </div>
    <div class="sidebar" id="sidebar">
      <div class="baselogo">
        <div class="logonew-icon">
          <i class="fa-solid fa-wand-sparkles"></i>
        </div>
        <h2>Admin Dashboard</h2>
      </div>
      <div class="cover_of_sidebar_links">
        <a href="{{url_for('admin_home')}}">
          <div class="sidelink">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              data-lucide="users"
              class="lucide lucide-users"
            >
              <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            Dashboard
          </div>
        </a>
        <a href="{{url_for('employee_details')}}">
          <div class="sidelink">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              data-lucide="user"
              class="lucide lucide-user"
            >
              <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            Employee Management
          </div>
        </a>
        <a href="{{url_for('tasks')}}">
          <div class="sidelink">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              data-lucide="clipboard-list"
              class="lucide lucide-clipboard-list"
            >
              <rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect>
              <path
                d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"
              ></path>
              <path d="M12 11h4"></path>
              <path d="M12 16h4"></path>
              <path d="M8 11h.01"></path>
              <path d="M8 16h.01"></path>
            </svg>
            Task Tracking
          </div>
        </a>
        <a href="{{ url_for('admin_leave_requests') }}">
          <div class="sidelink">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              data-lucide="calendar"
              class="lucide lucide-calendar"
            >
              <path d="M8 2v4"></path>
              <path d="M16 2v4"></path>
              <rect width="18" height="18" x="3" y="4" rx="2"></rect>
              <path d="M3 10h18"></path>
            </svg>
            Leave Requests
          </div>
        </a>
        <a href="{{url_for('performance')}}">
          <div class="sidelink">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              data-lucide="bar-chart-2"
              class="lucide lucide-bar-chart-2"
            >
              <line x1="18" x2="18" y1="20" y2="10"></line>
              <line x1="12" x2="12" y1="20" y2="4"></line>
              <line x1="6" x2="6" y1="20" y2="14"></line>
            </svg>
            Performance Reviews
          </div>
        </a>
        <a href="{{url_for('salary')}}">
          <div class="sidelink">
            <svg xmlns="http://www.w3.org/2000/svg" 
     width="24" height="24" 
     viewBox="0 0 24 24" 
     fill="none" 
     stroke="currentColor" 
     stroke-width="2" 
     stroke-linecap="round" 
     stroke-linejoin="round" 
     class="lucide lucide-wallet">
  <path d="M2 9.5V6a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v3.5"></path>
  <path d="M2 14.5V18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-3.5"></path>
  <path d="M2 9.5h20v5H2z"></path>
  <circle cx="17" cy="12" r="1"></circle>
</svg>

            Salary Management
          </div>
        </a>
        <a href="{{url_for('admin_complaints')}}">
          <div class="sidelink">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              data-lucide="clipboard-list"
              class="lucide lucide-clipboard-list"
            >
              <rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect>
              <path
                d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"
              ></path>
              <path d="M12 11h4"></path>
              <path d="M12 16h4"></path>
              <path d="M8 11h.01"></path>
              <path d="M8 16h.01"></path>
            </svg>
            Employee Reviews
          </div>
        </a>
      </div>
    </div>

    <div class="content">
      <div class="header"></div>

      <h1>Admin Complaint Dashboard</h1>
      {% if complaints %}
      <table>
        <thead>
          <tr>
            <th>Employee Email</th>
            <th>Title</th>
            <th>Description</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for complaint in complaints %}
          <tr>
            <td>{{ complaint['employee_email'] }}</td>
            <td>{{ complaint['title'] }}</td>
            <td>{{ complaint['description'] }}</td>
            <td>
              <form method="POST" action="{{ url_for('admin_complaints') }}" class="complaint-form">
                <input type="hidden" name="complaint_id" value="{{ complaint['_id'] }}">
                <textarea name="response" rows="2" placeholder="Add a response (optional)"></textarea>
                <div class="resolve_reject">
                  <button type="submit" name="action" value="resolve" class="action-btn">
                    Resolve
                  </button>
                  <button type="submit" name="action" value="reject" class="action-btn">
                    Reject
                  </button>
                </div>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="no-complaints">No complaints to manage at the moment.</p>
      {% endif %}
    </div>
    <!-- Loader HTML -->
    <div id="loader" class="loader-overlay">
      <div class="loader-container">
        <p>Processing your action, please wait...</p>
        <div class="spinner"></div>
      </div>
    </div>

    <script>
      const burgerIcon = document.getElementById("burgerIcon");
      const burgerIconClose = document.getElementById("burgerIconClose");
      const sidebar = document.getElementById("sidebar");
      const loader = document.getElementById("loader");

      // Sidebar toggle
      burgerIcon.addEventListener("click", () => {
        sidebar.classList.add("show");
        burgerIcon.style.display = "none";
        burgerIconClose.style.display = "block";
      });

      burgerIconClose.addEventListener("click", () => {
        sidebar.classList.remove("show");
        burgerIcon.style.display = "block";
        burgerIconClose.style.display = "none";
      });

      // Form submission with loader and popup
     // Form submission with loader and popup
document.querySelectorAll(".complaint-form").forEach(form => {
  // Track which button was clicked
  let lastAction = null;
  
  form.querySelectorAll(".action-btn").forEach(button => {
    button.addEventListener("click", function(e) {
      e.preventDefault(); // Prevent immediate submission
      lastAction = this.value;
      
      // Show loader
      document.getElementById("loader").classList.add("active");
      
      // Create hidden input for action
      let actionInput = form.querySelector('input[name="action"]');
      if (!actionInput) {
        actionInput = document.createElement('input');
        actionInput.type = 'hidden';
        actionInput.name = 'action';
        form.appendChild(actionInput);
      }
      actionInput.value = lastAction;
      
      // Show popup after 1.5 seconds (loader time)
      setTimeout(() => {
        document.getElementById("loader").classList.remove("active");
        
        if (lastAction === 'resolve') {
          showPopup('resolvePopup');
        } else if (lastAction === 'reject') {
          showPopup('rejectPopup');
        }
        
        // Submit the form after 1 second of showing popup
        setTimeout(() => {
          form.submit();
        }, 1000);
      }, 1500);
    });
  });
});

function showPopup(popupId) {
  const popup = document.getElementById(popupId);
  popup.classList.add("show");
  
  // Keep popup visible for 5 seconds
  setTimeout(() => {
    popup.classList.remove("show");
  }, 5000);
}
    </script>
  </body>
</html>

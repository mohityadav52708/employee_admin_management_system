<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Employee Details</title>
    <link rel="stylesheet" href="/static/admin_home.css" />
    <link rel="stylesheet" href="/static/emp_admin_details.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        
    </style>
</head>
<body>
    <div class="image">
        <h1 id="mobile">Welcome Back, <br />Admin {{ username }}</h1>
        <h1 id="dekstop">Welcome Back, Admin {{ username }}</h1>
        <div class="burger-icon open" id="burgerIcon">&#9776;</div>
        <div class="burger-icon close" id="burgerIconClose">&#10006;</div>
        
        <!-- Desktop Search -->
        <div class="search-wrapper">
            <div class="search-container dekstop">
                <input type="text" id="searchInput" placeholder="Search employees..." />
                <button class="search-btn"><i class="fa-solid fa-search"></i></button>
            </div>
            <div id="searchResults" class="search-results"></div>
        </div>
        <a href="/logout" class="logout-btn">
        <i class="fa-solid fa-right-from-bracket"></i>&nbsp;&nbsp;Logout</a
      >
    </div>

    <!-- Mobile Search (placed after sidebar) -->
    <div class="search-container mobile">
        <input type="text" id="mobileSearchInput" placeholder="Search employees..." />
        <button class="search-btn"><i class="fa-solid fa-search"></i></button>
        <div id="mobileSearchResults" class="search-results"></div>
    </div>

    <div class="sidebar" id="sidebar">
        <div class="baselogo">
            <div class="logonew-icon">
                <i class="fa-solid fa-wand-sparkles"></i>
            </div>
            <h2>Admin Dashboard</h2>
        </div>
        <div class="cover_of_sidebar_links">
            <!-- Sidebar links remain unchanged -->
            <!-- ... existing sidebar links ... -->
            <a href="{{url_for('admin_home')}}">
              <div class="sidelink">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  data-lucide="users"
                  class="lucide lucide-users"
                >
                  <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                  <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                Dashboard
              </div>
            </a>
            <a href="{{url_for('employee_details')}}">
              <div class="sidelink">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  data-lucide="user"
                  class="lucide lucide-user"
                >
                  <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                  <circle cx="12" cy="7" r="4"></circle>
                </svg>
                Employee Management
              </div>
            </a>
            <a href="{{url_for('tasks')}}">
              <div class="sidelink">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  data-lucide="clipboard-list"
                  class="lucide lucide-clipboard-list"
                >
                  <rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect>
                  <path
                    d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"
                  ></path>
                  <path d="M12 11h4"></path>
                  <path d="M12 16h4"></path>
                  <path d="M8 11h.01"></path>
                  <path d="M8 16h.01"></path>
                </svg>
               Task Tracking
              </div>
            </a>
            <a href="{{ url_for('admin_leave_requests') }}">
              <div class="sidelink">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  data-lucide="calendar"
                  class="lucide lucide-calendar"
                >
                  <path d="M8 2v4"></path>
                  <path d="M16 2v4"></path>
                  <rect width="18" height="18" x="3" y="4" rx="2"></rect>
                  <path d="M3 10h18"></path>
                </svg>
                Leave Requests
              </div>
            </a>
            <a href="{{url_for('performance')}}">
              <div class="sidelink">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  data-lucide="bar-chart-2"
                  class="lucide lucide-bar-chart-2"
                >
                  <line x1="18" x2="18" y1="20" y2="10"></line>
                  <line x1="12" x2="12" y1="20" y2="4"></line>
                  <line x1="6" x2="6" y1="20" y2="14"></line>
                </svg>
               Performance Reviews
              </div>
            </a>
            <a href="{{url_for('salary')}}">
              <div class="sidelink">
              <svg xmlns="http://www.w3.org/2000/svg" 
     width="24" height="24" 
     viewBox="0 0 24 24" 
     fill="none" 
     stroke="currentColor" 
     stroke-width="2" 
     stroke-linecap="round" 
     stroke-linejoin="round" 
     class="lucide lucide-wallet">
  <path d="M2 9.5V6a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v3.5"></path>
  <path d="M2 14.5V18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-3.5"></path>
  <path d="M2 9.5h20v5H2z"></path>
  <circle cx="17" cy="12" r="1"></circle>
</svg>

                Salary Management
              </div>
            </a>
            <a href="{{url_for('admin_complaints')}}">
              <div class="sidelink">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  data-lucide="clipboard-list"
                  class="lucide lucide-clipboard-list"
                >
                  <rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect>
                  <path
                    d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"
                  ></path>
                  <path d="M12 11h4"></path>
                  <path d="M12 16h4"></path>
                  <path d="M8 11h.01"></path>
                  <path d="M8 16h.01"></path>
                </svg>
                Employee Reviews
              </div>
            </a>
            </div>
        </div>
    </div>

    <div class="content">
        <h2>Employee Details</h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr id="table-emp-Details">
                        <th>Profile</th>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Department</th>
                        <th>Phone</th>
                        <th>Status</th>
                        <th>Availability</th>
                    </tr>
                </thead>
                <tbody>
                    {% for emp in employees %}
                    <tr>
                        <td>
                            <img src="{{ emp.profile_image if emp.profile_image else url_for('static', filename='default-profile.png') }}"
                                 alt="Profile Image" class="profile-img" />
                        </td>
                        <td>{{ emp.username }}</td>
                        <td>{{ emp.email }}</td>
                        <td>{{ emp.department or 'N/A' }}</td>
                        <td>{{ emp.phone or 'N/A' }}</td>
                        <td>{{ 'Verified' if emp.verified else 'Not Verified' }}</td>
                        <td>
                            {% if emp.availability == "Online" %}
                                <span style="color: #22c55e; font-weight: bold;">Online</span>
                            {% else %}
                                <span style="color: #ef4444; font-weight: bold;">Offline</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Shared search functionality
        function setupSearch(inputId, resultsId, isMobile = false) {
            const searchInput = document.getElementById(inputId);
            const resultsContainer = document.getElementById(resultsId);
            const employeeTable = document.querySelector(".table-container table tbody");

            function getEmployeeData() {
                const rows = employeeTable.querySelectorAll("tr");
                return Array.from(rows).map(row => ({
                    element: row,
                    name: row.cells[1].textContent.trim(),
                    email: row.cells[2].textContent.trim(),
                    department: row.cells[3].textContent.trim(),
                    phone: row.cells[4].textContent.trim(),
                    profileImg: row.cells[0].querySelector('img')?.src || ''
                }));
            }

            const allEmployees = getEmployeeData();

            function highlightText(text, query) {
                if (!query) return text;
                const regex = new RegExp(`(${query})`, 'gi');
                return text.replace(regex, '<span class="highlight">$1</span>');
            }

            function filterResults() {
                const query = searchInput.value.trim().toLowerCase();
                resultsContainer.innerHTML = "";

                if (!query) {
                    resultsContainer.classList.remove("active");
                    allEmployees.forEach(emp => emp.element.style.display = "");
                    return;
                }

                const matches = allEmployees.filter(emp => 
                    emp.name.toLowerCase().includes(query) || 
                    emp.email.toLowerCase().includes(query) || 
                    emp.department.toLowerCase().includes(query) ||
                    emp.phone.toLowerCase().includes(query)
                );

                if (matches.length > 0) {
                    matches.forEach(emp => {
                        const div = document.createElement("a");
                        div.className = "result-item";
                        div.href = "#";
                        div.innerHTML = `
                            ${emp.profileImg ? `<img src="${emp.profileImg}" alt="${emp.name}">` : ''}
                            <div class="employee-info">
                                <div class="name">${highlightText(emp.name, query)}</div>
                                <div class="department">${highlightText(emp.department, query)}</div>
                            </div>
                        `;
                        div.addEventListener('click', (e) => {
                            e.preventDefault();
                            allEmployees.forEach(e => e.element.style.display = "none");
                            emp.element.style.display = "";
                            searchInput.value = "";
                            resultsContainer.classList.remove("active");
                            if (isMobile) {
                                document.getElementById('mobileSearchResults').classList.remove("active");
                            } else {
                                document.getElementById('searchResults').classList.remove("active");
                            }
                        });
                        resultsContainer.appendChild(div);
                    });

                    allEmployees.forEach(emp => {
                        emp.element.style.display = matches.includes(emp) ? "" : "none";
                    });
                } else {
                    resultsContainer.innerHTML = `<div class="no-results">No matching employees found</div>`;
                    allEmployees.forEach(emp => emp.element.style.display = "none");
                }

                resultsContainer.classList.add("active");
            }

            searchInput.addEventListener("input", debounce(filterResults, 300));
        }

        function debounce(func, delay) {
            let timeout;
            return function() {
                const context = this;
                const args = arguments;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), delay);
            };
        }

        // Initialize both search inputs
        document.addEventListener('DOMContentLoaded', function() {
            setupSearch('searchInput', 'searchResults');
            setupSearch('mobileSearchInput', 'mobileSearchResults', true);
            
            // Close search results when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.search-container')) {
                    document.querySelectorAll('.search-results').forEach(el => {
                        el.classList.remove('active');
                    });
                }
            });

            // Sidebar toggle functionality
            const burgerIcon = document.getElementById("burgerIcon");
            const burgerIconClose = document.getElementById("burgerIconClose");
            const sidebar = document.getElementById("sidebar");

            burgerIcon.addEventListener("click", () => {
                sidebar.classList.add("show");
                burgerIcon.style.display = "none";
                burgerIconClose.style.display = "block";
            });

            burgerIconClose.addEventListener("click", () => {
                sidebar.classList.remove("show");
                burgerIcon.style.display = "block";
                burgerIconClose.style.display = "none";
            });
        });
    </script>
</body>
</html>